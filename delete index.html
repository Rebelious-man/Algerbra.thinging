<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DEMON — Fire Search Proxy (Downloadable)</title>
<style>
  :root{ --bg1:#070206; --bg2:#16040a; --bg3:#27070d; --ember:#ff1e2d; --text:#f7e9ea; --muted:#b77c86; --panel:rgba(255,255,255,0.04); --panel2:rgba(255,255,255,0.08); }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    display:grid; place-items:center; padding:24px;
    background:
      radial-gradient(1200px 800px at 70% 20%, #3b0a12 0%, transparent 60%),
      radial-gradient(900px 600px at 20% 0%, #420a12 0%, transparent 65%),
      linear-gradient(180deg, var(--bg3) 0%, var(--bg2) 35%, var(--bg1) 100%);
    overflow:hidden;
  }
  .smoke{ position:fixed; inset:-20%;
    background:
      radial-gradient(1200px 700px at 60% 120%, rgba(255,50,60,0.08), transparent 60%),
      radial-gradient(900px 500px at 40% 115%, rgba(255,120,0,0.06), transparent 65%),
      repeating-radial-gradient(circle at 50% 120%, rgba(255,255,255,0.02) 0 6px, rgba(0,0,0,0.02) 6px 12px);
    mix-blend-mode:screen; filter: blur(12px) saturate(120%); animation: drift 18s linear infinite; pointer-events:none; }
  @keyframes drift{ 0%{transform:translate3d(0,2%,0) scale(1)} 50%{transform:translate3d(0,-1%,0) scale(1.02)} 100%{transform:translate3d(0,2%,0) scale(1)} }
  .big-text{ font-size:44px; font-weight:900; letter-spacing:-.02em; text-align:center;
    text-shadow: 0 0 12px rgba(255,30,45,.35), 0 0 28px rgba(255,106,0,.25), 0 0 60px rgba(255,0,18,.25);
    animation:flicker 2.4s infinite steps(60); }
  @keyframes flicker{ 0%,19%,22%,63%,64%,70%,100%{filter:brightness(1);opacity:1} 20%,21%,65%{filter:brightness(.9);opacity:.95} 71%{filter:brightness(.75);opacity:.88} 72%{filter:brightness(1.15);opacity:1} }
  .small-text{ font-size:14px; color:var(--muted); text-align:center; margin-top:-6px }
  .wrap{ width:100%; max-width:1100px; display:grid; gap:16px; position:relative; z-index:2 }
  .card{ background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; backdrop-filter: blur(4px);
    box-shadow: 0 10px 40px rgba(0,0,0,.6), inset 0 0 60px rgba(255,40,40,.04); display:grid; gap:12px; }
  label{ font-size:13px; color:var(--muted); display:block; margin-bottom:6px }
  input,select,button{ width:100%; border:1px solid rgba(255,255,255,.12); border-radius:10px; background:var(--panel2); color:var(--text); padding:10px 12px; outline:none }
  input:focus,select:focus{ border-color:var(--ember); box-shadow:0 0 0 3px rgba(255,30,45,.18) }
  .row{ display:grid; grid-template-columns: 1fr 180px 160px 140px; gap:10px }
  .btns{ display:flex; gap:10px; flex-wrap:wrap }
  button{ cursor:pointer; transition: transform .05s ease } button:active{ transform: translateY(1px) }
  .primary{ background:linear-gradient(180deg,#b6161f,#8f0e15) }
  .muted{ background:linear-gradient(180deg,#2b0a0f,#1b0508) }
  .accent{ background:linear-gradient(180deg,#8b1a21,#5e0f13) }
  .note{ font-size:12px; color:var(--muted) }
  .viewer{ height:65vh; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.45) }
  iframe{ width:100%; height:100%; border:0; display:block; background:#0b0b0b }
  .toolbar{ display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap }
  .toolbar .left{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  .toolbar .right{ display:flex; gap:10px; align-items:center }
  .chip{ font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:var(--panel2) }
  .flames{ position:fixed; left:0; right:0; bottom:-6vh; height:32vh; z-index:1; pointer-events:none; display:block; overflow:hidden; filter: blur(1px) contrast(1.05) saturate(1.1) }
  .flame{ position:absolute; bottom:-10vh; width:9vw; height:40vh; left:var(--x);
    background:
      radial-gradient(60% 40% at 50% 100%, rgba(255,40,40,.95) 0%, rgba(255,40,40,.6) 30%, transparent 70%),
      radial-gradient(60% 50% at 48% 70%, rgba(0,0,0,.85) 0%, transparent 60%),
      radial-gradient(60% 50% at 52% 40%, rgba(0,0,0,.9) 0%, transparent 65%),
      radial-gradient(90% 90% at 50% 100%, rgba(0,0,0,.85) 40%, transparent 70%);
    mix-blend-mode: screen; transform-origin:50% 100%; animation: lick var(--speed) ease-in-out infinite;
    opacity:.75; filter: drop-shadow(0 -6px 20px rgba(255,30,45,.25));
    border-radius:50% 50% 40% 40% / 70% 70% 30% 30%; }
  .flame::before,.flame::after{ content:""; position:absolute; inset:0; border-radius:inherit; mix-blend-mode:screen;
    background:
      radial-gradient(50% 45% at 50% 95%, rgba(255,106,0,.7) 0%, transparent 60%),
      radial-gradient(70% 55% at 50% 70%, rgba(255,0,30,.5) 0%, transparent 70%);
    animation: sway calc(var(--speed) * .66) ease-in-out infinite; }
  .flame::after{ background:
      radial-gradient(45% 40% at 50% 98%, rgba(255,255,255,.08) 0%, transparent 60%),
      radial-gradient(40% 35% at 50% 70%, rgba(255,30,45,.35) 0%, transparent 70%);
    animation: sway calc(var(--speed) * 1.15) ease-in-out infinite reverse; }
  @keyframes lick{ 0%{ transform: translateY(0) scaleX(.95) scaleY(1) rotate(-1.2deg) } 50%{ transform: translateY(-3vh) scaleX(1.03) scaleY(1.08) rotate(1.2deg) } 100%{ transform: translateY(0) scaleX(.95) scaleY(1) rotate(-1.2deg) } }
  @keyframes sway{ 0%{ transform: translateX(-2%) skewX(-1deg) } 50%{ transform: translateX(2%) skewX(1deg) } 100%{ transform: translateX(-2%) skewX(-1deg) } }
</style>
</head>
<body>
  <div class="smoke" aria-hidden="true"></div>

  <div class="wrap">
    <div class="big-text">Welcome to DEMON</div>
    <div class="small-text">Fire Search Proxy — with HTML download</div>

    <div class="card">
      <div class="row">
        <input id="q" type="text" placeholder="Search the web (proxied) — e.g., best pizza in NYC" />
        <select id="engine">
          <option value="ddg">DuckDuckGo (HTML)</option>
          <option value="wikipedia">Wikipedia</option>
        </select>
        <select id="region">
          <option value="">Region: Default</option>
          <option value="us-en">US (en)</option>
          <option value="uk-en">UK (en)</option>
          <option value="in-en">India (en)</option>
        </select>
        <button id="go" class="primary">Search via Proxy</button>
      </div>

      <div class="toolbar">
        <div class="left">
          <span class="chip">All requests go through your Worker proxy</span>
          <span class="chip" id="targetChip">Target: —</span>
        </div>
        <div class="right">
          <button id="downloadRewritten" class="accent" title="Download the proxied HTML currently shown">Download proxied HTML</button>
          <button id="downloadOriginal" class="muted" title="Download the original fetched HTML">Download original HTML</button>
          <button id="openDirect" class="muted" title="Open current results in a new tab (still proxied)">Open in new tab</button>
          <button id="reset" class="muted">Reset</button>
        </div>
      </div>

      <div id="viewer" class="viewer">
        <iframe id="frame" sandbox="allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox" referrerpolicy="no-referrer"></iframe>
      </div>

      <div class="note">
        • Links in results are rewritten to keep using your proxy.  
        • Downloaded HTML is a snapshot of the current page (external assets aren’t embedded).
      </div>
    </div>
  </div>

  <div class="flames" aria-hidden="true">
    <div class="flame" style="--x:2vw;  --speed:3.6s"></div>
    <div class="flame" style="--x:10vw; --speed:4.2s"></div>
    <div class="flame" style="--x:18vw; --speed:3.0s"></div>
    <div class="flame" style="--x:26vw; --speed:4.6s"></div>
    <div class="flame" style="--x:34vw; --speed:3.4s"></div>
    <div class="flame" style="--x:42vw; --speed:3.9s"></div>
    <div class="flame" style="--x:50vw; --speed:3.2s"></div>
    <div class="flame" style="--x:58vw; --speed:4.4s"></div>
    <div class="flame" style="--x:66vw; --speed:3.1s"></div>
    <div class="flame" style="--x:74vw; --speed:4.0s"></div>
    <div class="flame" style="--x:82vw; --speed:3.3s"></div>
    <div class="flame" style="--x:90vw; --speed:4.8s"></div>
  </div>

<script>
/* =======================
   CONFIGURE THIS SECTION
   ======================= */
const WORKER_BASE = "https://YOUR-WORKER-URL"; // e.g., https://demon-proxy.<acct>.workers.dev or https://proxy.yourdomain.com
const REQUIRE_KEY = false;                      // set to true if your Worker requires x-proxy-key
const X_PROXY_KEY = "YOUR_SECRET_IF_USED";

/* -------- Helpers -------- */
const $ = (id) => document.getElementById(id);
const proxyURL = (target) => `${WORKER_BASE.replace(/\/$/, "")}/proxy?url=${encodeURIComponent(target)}`;
const sanitize = (s) => (s || "").toLowerCase().replace(/[^a-z0-9\-_.]+/g, "-").replace(/^-+|-+$/g, "").substring(0,120) || "page";

/* Build search engine target URL */
function engineUrl(engine, query, region) {
  const q = encodeURIComponent(query.trim());
  if (engine === "wikipedia") {
    const lang = (region || "").startsWith("uk-") ? "en" : (region || "").startsWith("in-") ? "en" : "en";
    return `https://${lang}.wikipedia.org/w/index.php?search=${q}`;
  }
  let params = `q=${q}&ia=web&kp=-2`;
  if (region === "us-en") params += "&kl=us-en";
  if (region === "uk-en") params += "&kl=uk-en";
  if (region === "in-en") params += "&kl=in-en";
  return `https://duckduckgo.com/html/?${params}`;
}

/* Rewrite links/forms so navigation stays proxied */
function rewriteHtmlToStayProxied(html, baseUrl) {
  try {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    const base = new URL(baseUrl);

    doc.querySelectorAll("a[href]").forEach(a => {
      try {
        const abs = new URL(a.getAttribute("href"), base);
        a.setAttribute("href", proxyURL(abs.toString()));
        a.setAttribute("target", "_top");
        a.setAttribute("rel", "noopener");
      } catch {}
    });

    doc.querySelectorAll("form[action]").forEach(f => {
      try {
        const method = (f.getAttribute("method") || "GET").toUpperCase();
        const abs = new URL(f.getAttribute("action"), base);
        if (method === "POST") f.setAttribute("method", "GET");
        f.setAttribute("action", proxyURL(abs.toString()));
        f.setAttribute("target", "_top");
      } catch {}
    });

    const banner = doc.createElement("div");
    banner.textContent = "Viewing via DEMON proxy";
    Object.assign(banner.style, {
      position:"sticky", top:"0", left:"0", right:"0",
      background:"#1a070a", color:"#f7e9ea", font:"14px system-ui, sans-serif",
      padding:"8px 12px", zIndex:"999999", borderBottom:"1px solid rgba(255,255,255,0.15)"
    });
    doc.body && doc.body.prepend(banner);

    return "<!doctype html>\n" + doc.documentElement.outerHTML;
  } catch { return html; }
}

/* Download utility */
function downloadText(filename, text) {
  const blob = new Blob([text], { type: "text/html;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* UI elements */
const qEl = $("q"), engineEl = $("engine"), regionEl = $("region");
const goEl = $("go"), frame = $("frame"), targetChip = $("targetChip");
const btnOpen = $("openDirect"), btnReset = $("reset");
const btnDlRewritten = $("downloadRewritten"), btnDlOriginal = $("downloadOriginal");

/* State for downloads */
let lastTarget = "";
let lastOriginalHtml = "";
let lastRewrittenHtml = "";

/* Actions */
function setTargetChip(url){ targetChip.textContent = "Target: " + (url || "—"); }

async function runSearch() {
  const query = qEl.value.trim();
  if (!query) return;

  const target = engineUrl(engineEl.value, query, regionEl.value);
  lastTarget = target;
  setTargetChip(target);

  const prox = proxyURL(target);
  const headers = new Headers();
  if (REQUIRE_KEY) headers.set("x-proxy-key", X_PROXY_KEY);

  try {
    const resp = await fetch(prox, { headers });
    const txt = await resp.text();
    lastOriginalHtml = txt;

    const rewritten = rewriteHtmlToStayProxied(txt, target);
    lastRewrittenHtml = rewritten;

    frame.srcdoc = rewritten;
    btnOpen.onclick = () => window.open(prox, "_blank", "noopener");
  } catch (e) {
    const err = String(e && e.message ? e.message : e);
    lastOriginalHtml = ""; lastRewrittenHtml = "";
    frame.srcdoc = `<pre style="color:#f7e9ea;background:#0b0b0b;padding:16px;">Proxy fetch failed:\n${err}</pre>`;
  }
}

goEl.addEventListener("click", runSearch);
qEl.addEventListener("keydown", (e) => { if (e.key === "Enter") runSearch(); });
btnReset.addEventListener("click", () => {
  qEl.value = ""; lastOriginalHtml = ""; lastRewrittenHtml = ""; lastTarget = "";
  frame.srcdoc = ""; setTargetChip("—");
});
btnDlRewritten.addEventListener("click", () => {
  if (!lastRewrittenHtml) return;
  const name = `proxied-${sanitize(engineEl.value)}-${sanitize(qEl.value)}.html`;
  downloadText(name, lastRewrittenHtml);
});
btnDlOriginal.addEventListener("click", () => {
  if (!lastOriginalHtml) return;
  const name = `original-${sanitize(engineEl.value)}-${sanitize(qEl.value)}.html`;
  downloadText(name, lastOriginalHtml);
});

/* Prefill for demo */
qEl.value = "fire themed website css";
setTargetChip("—");
</script>
</body>
</html>
